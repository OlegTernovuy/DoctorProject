{"ast":null,"code":"import _regeneratorRuntime from\"/Users/olegternovij/Documents/React/doctor-main/client/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/Users/olegternovij/Documents/React/doctor-main/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import{Form}from\"./Form\";import{useDispatch}from\"react-redux\";import{setUser}from\"../pages/store/slices/userSlice\";import{useNavigate}from\"react-router-dom\";import{getAuth,signInWithEmailAndPassword}from\"firebase/auth\";import{jsx as _jsx}from\"react/jsx-runtime\";export var Login=function Login(_ref){var setIsAdmin=_ref.setIsAdmin,setIsLoggedIn=_ref.setIsLoggedIn;var dispatch=useDispatch();var history=useNavigate();var handleLogin=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(email,password){var responce,data;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return fetch('https://doctor-study-project.herokuapp.com/auth/login',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({username:email,password:password})});case 3:responce=_context.sent;_context.next=6;return responce.json();case 6:data=_context.sent;if(responce.status===200){if(data.user.token){localStorage.setItem('isLoggedIn','true');dispatch(setUser({email:data.user.username,id:data.user._id,token:data.user.token}));history(\"/\");setIsLoggedIn(true);}if(data.user.role==='admin'){localStorage.setItem('isAdmin','true');setIsLoggedIn(true);setIsAdmin(true);}}else{alert(data.message);}_context.next=14;break;case 10:_context.prev=10;_context.t0=_context[\"catch\"](0);alert(_context.t0);console.log(_context.t0);case 14:case\"end\":return _context.stop();}}},_callee,null,[[0,10]]);}));return function handleLogin(_x,_x2){return _ref2.apply(this,arguments);};}();return/*#__PURE__*/_jsx(Form,{title:\"sign in\",handleClick:handleLogin});};","map":{"version":3,"names":["Form","useDispatch","setUser","useNavigate","getAuth","signInWithEmailAndPassword","Login","setIsAdmin","setIsLoggedIn","dispatch","history","handleLogin","email","password","fetch","method","headers","body","JSON","stringify","username","responce","json","data","status","user","token","localStorage","setItem","id","_id","role","alert","message","console","log"],"sources":["/Users/olegternovij/Documents/React/doctor-main/client/src/LogReg/Login.jsx"],"sourcesContent":["import { Form } from \"./Form\";\nimport { useDispatch } from \"react-redux\";\nimport { setUser  } from \"../pages/store/slices/userSlice\";\nimport { useNavigate } from \"react-router-dom\";\n\nimport { getAuth, signInWithEmailAndPassword } from \"firebase/auth\";\n\n\n\nexport const Login = ({setIsAdmin,setIsLoggedIn}) => {\n    const dispatch = useDispatch(); \n    const history = useNavigate();\n\n\n    const handleLogin = async (email, password) => {\n      //   const auth = getAuth();\n      //   signInWithEmailAndPassword(auth, email, password)\n      //   .then((({user}) => {\n      //       dispatch(setUser({\n      //           email: user.email,\n      //           id: user.uid,\n      //           token: user.accessToken,\n      //       }))\n      //   }))\n      //   history(\"/\")\n      //   .catch(() => alert(\"error\"))\n\n\t\ttry{\n\t\t\tconst responce = await fetch('https://doctor-study-project.herokuapp.com/auth/login',{\n\t\t\t\tmethod:'POST',\n\t\t\t\theaders:{\n\t\t\t\t\t'Content-Type':'application/json'\n\t\t\t\t},\n\t\t\t\tbody: JSON.stringify({username:email,password})\n\t\t\t})\n\t\t\tconst data = await responce.json()\n\t\t\tif(responce.status === 200){\n\t\t\t\tif(data.user.token){\n\t\t\t\t\tlocalStorage.setItem('isLoggedIn','true')\n\t\t\t\t\tdispatch(setUser({\n\t\t\t\t\t    email: data.user.username,\n\t\t\t\t\t    id: data.user._id,\n\t\t\t\t\t    token: data.user.token,\n\t\t\t\t\t}))\n\t\t\t\t\thistory(\"/\")\n\t\t\t\t\tsetIsLoggedIn(true)\n\t\t\t\t}\n\t\t\t\tif(data.user.role === 'admin'){\n\t\t\t\t\tlocalStorage.setItem('isAdmin','true')\n\t\t\t\t\tsetIsLoggedIn(true)\n\t\t\t\t\tsetIsAdmin(true)\n\t\t\t\t}\n\t\t\t}else{\n\t\t\t\talert(data.message)\n\t\t\t}\n\n\t\t}catch(err){\n\t\t\talert(err)\n\t\t\tconsole.log(err);\n\t\t}\n    }\n\n    return(\n        <Form\n            title=\"sign in\"\n            handleClick={handleLogin}\n        />\n    )\n}"],"mappings":"wSAAA,OAASA,IAAT,KAAqB,QAArB,CACA,OAASC,WAAT,KAA4B,aAA5B,CACA,OAASC,OAAT,KAAyB,iCAAzB,CACA,OAASC,WAAT,KAA4B,kBAA5B,CAEA,OAASC,OAAT,CAAkBC,0BAAlB,KAAoD,eAApD,C,2CAIA,MAAO,IAAMC,MAAK,CAAG,QAARA,MAAQ,MAAgC,IAA9BC,WAA8B,MAA9BA,UAA8B,CAAnBC,aAAmB,MAAnBA,aAAmB,CACjD,GAAMC,SAAQ,CAAGR,WAAW,EAA5B,CACA,GAAMS,QAAO,CAAGP,WAAW,EAA3B,CAGA,GAAMQ,YAAW,6FAAG,iBAAOC,KAAP,CAAcC,QAAd,4KAcEC,MAAK,CAAC,uDAAD,CAAyD,CACpFC,MAAM,CAAC,MAD6E,CAEpFC,OAAO,CAAC,CACP,eAAe,kBADR,CAF4E,CAKpFC,IAAI,CAAEC,IAAI,CAACC,SAAL,CAAe,CAACC,QAAQ,CAACR,KAAV,CAAgBC,QAAQ,CAARA,QAAhB,CAAf,CAL8E,CAAzD,CAdP,QAcfQ,QAde,qCAqBFA,SAAQ,CAACC,IAAT,EArBE,QAqBfC,IArBe,eAsBrB,GAAGF,QAAQ,CAACG,MAAT,GAAoB,GAAvB,CAA2B,CAC1B,GAAGD,IAAI,CAACE,IAAL,CAAUC,KAAb,CAAmB,CAClBC,YAAY,CAACC,OAAb,CAAqB,YAArB,CAAkC,MAAlC,EACAnB,QAAQ,CAACP,OAAO,CAAC,CACbU,KAAK,CAAEW,IAAI,CAACE,IAAL,CAAUL,QADJ,CAEbS,EAAE,CAAEN,IAAI,CAACE,IAAL,CAAUK,GAFD,CAGbJ,KAAK,CAAEH,IAAI,CAACE,IAAL,CAAUC,KAHJ,CAAD,CAAR,CAAR,CAKAhB,OAAO,CAAC,GAAD,CAAP,CACAF,aAAa,CAAC,IAAD,CAAb,CACA,CACD,GAAGe,IAAI,CAACE,IAAL,CAAUM,IAAV,GAAmB,OAAtB,CAA8B,CAC7BJ,YAAY,CAACC,OAAb,CAAqB,SAArB,CAA+B,MAA/B,EACApB,aAAa,CAAC,IAAD,CAAb,CACAD,UAAU,CAAC,IAAD,CAAV,CACA,CACD,CAhBD,IAgBK,CACJyB,KAAK,CAACT,IAAI,CAACU,OAAN,CAAL,CACA,CAxCoB,iFA2CrBD,KAAK,aAAL,CACAE,OAAO,CAACC,GAAR,cA5CqB,qEAAH,kBAAXxB,YAAW,iDAAjB,CAgDA,mBACI,KAAC,IAAD,EACI,KAAK,CAAC,SADV,CAEI,WAAW,CAAEA,WAFjB,EADJ,CAMH,CA3DM"},"metadata":{},"sourceType":"module"}